# 1Password Vault Restriction Configuration
# SECURITY: This project uses a Service Account restricted to Developer vault only
#
# Service Account: claude-code-dev
# Vault Access: Developer (rtbdzfkcstpqfcot4gl66xbeky) - ONLY
#
# Usage: source this file before any op commands
#   source config/1password-vault.conf

# Vault configuration
export OP_VAULT_ID="rtbdzfkcstpqfcot4gl66xbeky"
export OP_VAULT_NAME="Developer"
export OP_VAULT="$OP_VAULT_ID"

# Load service account token (stored securely outside repo)
_load_op_token() {
    local token_file="$HOME/.config/op/claude-dev-token"
    if [[ -f "$token_file" ]]; then
        export OP_SERVICE_ACCOUNT_TOKEN="$(cat "$token_file")"
        return 0
    else
        echo "ERROR: Service account token not found at $token_file" >&2
        echo "Run: scripts/setup-1password.sh to configure" >&2
        return 1
    fi
}

# Initialize if not already loaded
if [[ -z "${OP_SERVICE_ACCOUNT_TOKEN:-}" ]]; then
    _load_op_token
fi

# Verify vault access (should only show Developer)
op_verify_access() {
    local vaults
    vaults=$(op vault list --format json 2>/dev/null | grep -c '"id"')
    if [[ "$vaults" -eq 1 ]]; then
        echo "Access verified: Developer vault only"
        return 0
    else
        echo "WARNING: Unexpected vault count: $vaults" >&2
        op vault list
        return 1
    fi
}

echo "1Password: Service Account (Developer vault only)"
